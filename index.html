<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>葬送的芙莉莲 · 沉浸式背景导航</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+SC:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root{--text:#e8ecff;--muted:#a8b7ff;--primary:#7ad0ff;--accent:#b58cff}
        *{box-sizing:border-box} html,body{height:100%}
        body{margin:0;color:var(--text);font-family:"Noto Sans SC",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0b1020;overflow:hidden}

        /* 背景视频：全屏铺底 */
        #bgv{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:-3;background:#0b1020}
        /* 若无视频 -> WebGL/Canvas 着色器层与极光/网格 */
        .fx{position:fixed;inset:0;pointer-events:none;z-index:-2}
        .fx::before{content:"";position:absolute;inset:0;mix-blend-mode:screen;opacity:.55;
            background:
                    radial-gradient(60% 60% at 20% 10%, #7ad0ff22, transparent 60%),
                    radial-gradient(60% 60% at 80% 25%, #b58cff22, transparent 60%),
                    conic-gradient(from 0deg, #7ad0ff0d, #b58cff12, #7ad0ff0d);
            animation:spin 28s linear infinite}
        .fx::after{content:"";position:absolute;inset:0;opacity:.18;
            background:
                    radial-gradient(1200px 600px at 10% -10%, #0008, transparent 60%),
                    radial-gradient(900px 600px at 110% 20%, #0006, transparent 60%),
                    radial-gradient(#ffffff15 1px, transparent 1.2px);
            background-size:auto,auto,10px 10px}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* WebGL/Canvas 容器（视频失败时显示） */
        #shader{position:fixed;inset:0;z-index:-4;display:block}

        .wrap{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:28px 20px 120px}
        header{display:flex;align-items:center;gap:16px;padding:6px 6px 18px}
        .brand{font-family:"Bebas Neue";letter-spacing:.6px;font-size:26px;text-shadow:0 0 24px #7ad0ff66}
        nav{margin-left:auto;display:flex;gap:24px;font-size:14px;color:#c9d4ff;opacity:.95}
        nav a{color:inherit;text-decoration:none;position:relative}
        nav a::after{content:"";position:absolute;left:0;bottom:-6px;height:2px;width:0;background:linear-gradient(90deg,var(--primary),var(--accent));transition:.3s}
        nav a:hover::after{width:100%}

        .title{margin:10px 4px 0;font-family:"Bebas Neue";font-size:clamp(42px,8vw,120px);line-height:.95;letter-spacing:1px;
            text-shadow:0 0 24px #7ad0ff66,0 0 48px #b58cff44}
        .muted{color:var(--muted)}

        /* 右下角沉浸式链接（无卡片、无底色，仅霓虹文字） */
        .nav-float{position:fixed;right:28px;bottom:26px;z-index:2;display:flex;gap:22px;flex-wrap:wrap}
        .chip{display:inline-flex;align-items:center;gap:10px;text-decoration:none;color:var(--text);font-weight:700;letter-spacing:.3px;
            text-shadow:0 0 10px #7ad0ff80,0 0 30px #b58cff60;transition:transform .2s ease;backdrop-filter:none}
        .chip svg{opacity:.95} .chip:hover{transform:translateY(-1px) scale(1.03)}
        .chip .u{position:relative;display:inline-block}
        .chip .u::after{content:"";position:absolute;left:0;right:0;bottom:-3px;height:2px;background:linear-gradient(90deg,var(--primary),var(--accent));
            box-shadow:0 0 12px #7ad0ff80;transform:scaleX(.4);transform-origin:left;transition:.25s}
        .chip:hover .u::after{transform:scaleX(1)}
        @media (max-width:640px){.nav-float{left:50%;right:auto;transform:translateX(-50%)}}

        /* 顶部轻量提示按钮（本地/自托管视频载入） */
        .controls{position:fixed;left:16px;bottom:16px;z-index:2;display:flex;gap:10px;align-items:center}
        .btn{border:1px solid #ffffff30;background:linear-gradient(180deg,#121a33,#0f162b);color:#e8ecff;padding:8px 12px;border-radius:999px;font-size:12px}
        .btn input{display:none}
        .btn label{cursor:pointer}

        .particles{position:fixed;inset:0;pointer-events:none;z-index:0}
        .dot{position:absolute;width:3px;height:3px;border-radius:50%;background:radial-gradient(#e8f6ff,#7ad0ff00);animation:float linear infinite;opacity:.7}
        @keyframes float{from{transform:translateY(40px)} to{transform:translateY(-640px)}}

        @media (prefers-reduced-motion:reduce){.fx::before{animation:none}.dot{animation-duration:0s}}
    </style>
</head>
<body>
<video id="bgv" autoplay muted loop playsinline preload="auto"></video>
<canvas id="shader"></canvas>
<div class="fx" aria-hidden="true"></div>

<div class="wrap">
    <header>
        <div class="brand">FRIEREN ARCHIVE</div>
        <nav><a href="#">社区</a><a href="#">设定集</a><a href="#">周边</a><a href="#">联系</a></nav>
    </header>
    <h1 class="title">CREATION OF <span class="muted">ANIME UI</span><br/>葬送的芙莉莲</h1>
</div>

<!-- 沉浸式右下角导航 -->
<div class="nav-float">
    <a class="chip" href="https://sublink.nanno.top/" aria-label="打开 sublink.nanno.top">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M10.6 13.4a1 1 0 1 1-1.4-1.4l4.3-4.3a3.5 3.5 0 1 1 5 5l-2.1 2.1a1 1 0 1 1-1.4-1.4l2.1-2.1a1.5 1.5 0 1 0-2.1-2.1l-4.3 4.3Z"/><path d="M13.4 10.6a1 1 0 1 1 1.4 1.4l-4.3 4.3a3.5 3.5 0 1 1-5-5l2.1-2.1a1 1 0 1 1 1.4 1.4L6.9 12a1.5 1.5 0 0 0 2.1 2.1l4.4-3.5Z"/></svg>
        <span class="u">sublink.nanno.top</span>
    </a>
    <a class="chip" href="https://augment.nanno.top/" aria-label="打开 augment.nanno.top">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2c1.5 4.5-1 6.5-1 8.5A3.5 3.5 0 0 0 14.5 14c0 2.5-2 4.5-4.5 4.5S5.5 16.5 5.5 14c0-3.5 3.5-4.5 3.5-7 0-1.4-.6-2.7-1.2-3.8C10 4.4 13 6.3 13 9c0 1.7-1.2 3-2.5 3s-2.5-1.3-2.5-3c0-1.1.5-2.1 1.2-3.1C10.5 3.3 12 2 12 2Z"/></svg>
        <span class="u">augment.nanno.top</span>
    </a>
</div>

<!-- 本地/自托管视频载入控件：可选 -->
<div class="controls">
    <button class="btn" id="muteBtn">🔇 静音</button>
    <div class="btn"><label for="file">选择本地视频</label><input id="file" type="file" accept="video/mp4,video/webm,video/ogg"/></div>
</div>

<div class="particles" id="particles"></div>

<script>
    // 1) 尝试从 URL ?bg=xxx.mp4 读取自托管视频
    const q = new URLSearchParams(location.search);
    const bg = q.get('bg');           // 例如 https://your.cdn/frieren1080.mp4
    const v = document.getElementById('bgv');
    if(bg){ v.src = bg; }

    // 2) 选择本地视频（无需登录、无需服务器）
    document.getElementById('file').addEventListener('change', e=>{
        const f=e.target.files[0]; if(!f) return;
        v.src = URL.createObjectURL(f); v.play().catch(()=>{});
    });

    // 3) 自动播放策略处理
    v.muted = true; v.autoplay = true; v.loop = true; v.playsInline = true;
    const tryPlay = ()=> v.play().catch(()=>{/* 若失败，用户点击后再播 */});
    document.addEventListener('DOMContentLoaded', tryPlay);

    // 4) 静音切换
    const muteBtn = document.getElementById('muteBtn');
    const refreshMuteBtn = ()=> muteBtn.textContent = v.muted ? '🔇 静音' : '🔊 声音';
    muteBtn.addEventListener('click', ()=>{ v.muted = !v.muted; tryPlay(); refreshMuteBtn(); });
    refreshMuteBtn();

    // 5) 若没有视频或加载失败 -> 显示 Canvas 着色器（冰蓝×紫色动态）
    v.addEventListener('error', ()=> startShader());
    if(!bg && !q.has('novid')) startShader(); // 初次无 src 时先跑着色器，等视频选择后覆盖

    function startShader(){
        const c = document.getElementById('shader'); const gl = c.getContext('webgl');
        const DPR = Math.min(2, window.devicePixelRatio||1);
        function resize(){ c.width = innerWidth*DPR; c.height = innerHeight*DPR; c.style.width='100%'; c.style.height='100%'; gl.viewport(0,0,c.width,c.height); }
        if(!gl){ simpleGradient(); return; }
        const vs=`attribute vec2 p;void main(){gl_Position=vec4(p,0.0,1.0);} `;
        const fs=`precision highp float;uniform vec2 r;uniform float t;
      float n(vec2 p){return fract(sin(dot(p,vec2(27.168,38.905)))*43758.5453);}
      float noise(vec2 p){vec2 i=floor(p),f=fract(p);float a=n(i),b=n(i+vec2(1.,0.)),c=n(i+vec2(0.,1.)),d=n(i+vec2(1.,1.));
        vec2 u=f*f*(3.-2.*f);return mix(a,b,u.x)+ (c-a)*u.y*(1.-u.x)+ (d-b)*u.x*u.y;}
      void main(){
        vec2 uv=(gl_FragCoord.xy/r.xy);
        float t1=t*0.05, t2=t*0.09;
        float m1=noise(uv*3.0+vec2(t1, -t1));
        float m2=noise(uv*2.0+vec2(-t2, t2));
        vec3 c1=vec3(0.45,0.82,1.0); // 冰蓝
        vec3 c2=vec3(0.71,0.55,1.0); // 紫
        vec3 col=mix(c1,c2,smoothstep(0.2,0.8,m1))+0.15*m2;
        col+=0.08*sin(uv.yxx*9.0+t*0.8);
        col*=1.0-0.35*pow(distance(uv,vec2(0.5)),1.3); // 暗角
        gl_FragColor=vec4(col,1.0);
      }`;
        function compile(t,s){const sh=gl.createShader(t);gl.shaderSource(sh,s);gl.compileShader(sh);return sh}
        const pr=gl.createProgram(); gl.attachShader(pr,compile(gl.VERTEX_SHADER,vs)); gl.attachShader(pr,compile(gl.FRAGMENT_SHADER,fs)); gl.linkProgram(pr); gl.useProgram(pr);
        const buf=gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER,buf); gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),gl.STATIC_DRAW);
        const loc=gl.getAttribLocation(pr,"p"); gl.enableVertexAttribArray(loc); gl.vertexAttribPointer(loc,2,gl.FLOAT,false,0,0);
        const uR=gl.getUniformLocation(pr,"r"), uT=gl.getUniformLocation(pr,"t");
        resize(); window.addEventListener('resize',resize);
        let st=performance.now();
        (function draw(){
            gl.uniform2f(uR,c.width,c.height);
            gl.uniform1f(uT,(performance.now()-st)/1000.0);
            gl.drawArrays(gl.TRIANGLE_STRIP,0,4);
            requestAnimationFrame(draw);
        })();
        function simpleGradient(){ // 无 WebGL 时简单渐变
            const ctx=c.getContext('2d'); resize();
            let t=0; (function loop(){ t+=0.01; const g=ctx.createLinearGradient(0,0,c.width,c.height);
                g.addColorStop(0,`hsl(${200+20*Math.sin(t)},100%,60%)`); g.addColorStop(1,`hsl(${270+20*Math.cos(t)},100%,65%)`);
                ctx.fillStyle=g; ctx.fillRect(0,0,c.width,c.height); requestAnimationFrame(loop); })();
        }
    }

    // 6) 轻粒子
    (function(){
        const box=document.getElementById('particles');
        if(!box) return;
    })();
    (function(){ // 直接在 body 上生成，减少节点
        const N=90, frag=document.createDocumentFragment(), H=innerHeight, W=innerWidth;
        for(let i=0;i<N;i++){
            const d=document.createElement('span');
            d.className='dot'; d.style.position='fixed';
            d.style.left=(Math.random()*W)+'px'; d.style.top=(Math.random()*H)+'px';
            d.style.animationDuration=(18+Math.random()*22)+'s'; d.style.opacity=.35+Math.random()*.65;
            frag.appendChild(d);
        }
        document.body.appendChild(frag);
    })();
</script>
</body>
</html>
